const bcrypt=require("bcryptjs"),dbms=require("../lib/dbms/"),request=require("request"),path=require("path"),User=require("../models/User").User,Q=require("q");exports.localReg=function(e){let s=Q.defer(),r=User.findBy({username:e.username});if(null!=r)console.log("USERNAME ALREADY EXISTS:",r.username),s.resolve({status:!1,result:{},msg:"账号:"+r.username+"已经被注册，请换个账号再试！"});else{console.log("CREATING USER:",e.username);let r=e;User.create(r),s.resolve({status:!0,user:r,msg:"注册信息已提交，2个工作日内完成审核。更多请咨询ACME爱客美（中国）售后客服微信：Acmeppf886，或拨打4008X-XXX-XXX方便查询全国免费接听"})}return s.promise},exports.localAuth=function(e,s){let r=Q.defer(),l=User.findBy({username:e});if(null==l)r.resolve({status:!1,msg:"USERNAME NOT FOUND:"+e});else{let e=l.password;console.log("FOUND USER: "+l.username),bcrypt.compareSync(s,e)?("hudao"===l.username&&User.delay(!1),"delay"===l.username&&User.delay(!0),r.resolve({status:!0,user:l})):(console.log("AUTHENTICATION FAILED"),r.resolve({status:!1,user:null,msg:"密码或者账号错误，请确认后再试！"}))}return r.promise};