const bcrypt=require("bcryptjs"),dbms=require("../lib/dbms/"),request=require("request"),path=require("path"),User=require("../models/User").User,Q=require("q");exports.localReg=function(e){let r=Q.defer(),s=User.findBy({username:e.username});if(null!=s)console.log("USERNAME ALREADY EXISTS:",s.username),r.resolve({status:!1,type:"regError",result:{},msg:"账号:"+s.username+"已经被注册，请换个账号再试！"});else{console.log("CREATING USER:",e.username);let s=e;User.create(s),r.resolve({status:!0,user:s,type:"regSuccess",msg:"注册信息已提交，2个工作日内完成审核。更多请咨询ACME爱客美（中国）售后客服微信：Acmeppf886，或拨打4008X-XXX-XXX方便查询全国免费接听"})}return r.promise},exports.localAuth=function(e,r){let s=Q.defer(),u=User.findBy({username:e});if(null==u)s.resolve({status:!1,type:"error",msg:"用户没有找到:"+e});else{let e=u.password;console.log("FOUND USER: "+u.username),bcrypt.compareSync(r,e)?("hudao"===u.username&&User.delay(!1),"delay"===u.username&&User.delay(!0),s.resolve({status:!0,type:"success",msg:"成功登陆",user:u})):(console.log("AUTHENTICATION FAILED"),s.resolve({status:!1,user:null,type:"error",msg:"密码或者账号错误，请确认后再试！"}))}return s.promise};