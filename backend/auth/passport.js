const passport=require("passport"),funct=require("./functions.js"),LocalStrategy=require("passport-local");function ensureAuthenticated(s,e,l){return l()}passport.serializeUser(function(s,e){console.log("serializing "+s.username),e(null,s)}),passport.deserializeUser(function(s,e){console.log("deserializing "+s),e(null,s)}),passport.use("local-signin",new LocalStrategy({passReqToCallback:!0},function(s,e,l,o){funct.localAuth(e,l).then(function(e){if(e.status){s.user=e.user;let l=e.user;s.session.sessionFlash={type:"success",message:"登陆成功"},console.log("LOGGED IN AS!!!!!!!!!!!: "+l.username),s.flash(e.type,e.msg),o(null,e.user)}else s.session.sessionFlash={type:"danger",message:e.msg},console.log("COULD NOT LOG IN"),console.log(e),s.flash(e.type,e.msg),o(null,null)}).fail(function(s){console.log(s.body)})})),passport.use("local-signup",new LocalStrategy({passReqToCallback:!0},function(s,e,l,o){try{s.body.password=l,s.body.username=e,funct.localReg(s.body).then(function(e){if(s.result=e,e.status){let l=s.user=e.user;console.log("REGISTERED: "+l.username),s.flash(e.type,e.msg),s.session.sessionFlash={type:"success",message:e.msg},o(null,null)}else s.session.sessionFlash={type:"danger",message:e.msg},s.flash(e.type,e.msg),console.log(e.msg),o(null,null)}).fail(function(s){console.log(s.body)})}catch(s){throw console.log(s),s}}));