const User=require("../../models/User").User,parse=require("../../helpers/parseList").parse,validate=require("../../helpers/validation").validate;module.exports={index:function(e,s){e.query.sort="updatedAt",e.query.sort="DESC";let t=parse("users",e,s,["username"],{isAdmin:!1,role:1},!0);s.json({total:t.total,rows:User.format(t.chain)})},show:function(e,s){if(e.query.uname){var t=User.findBy({username:e.query.uname});t?(t.contact=contact,s.json({status:!0,user:t})):s.json({status:!1})}},update:function(e,s){let t={id:e.body.id};void 0!=e.body.isActive&&(t.isActive=e.body.isActive);let r=e.body._action;delete e.body._action;let i,o=e.body.password;if(o&&(t.password=o),"reset"==r){let e=User.findBy({username:"admin"});console.log(e.id),t.id=e.id,o="2017-123456",t.passwordInited="2017-123456"==o}"reset"==r||o?(t.isActive=!0,i=User.update(t),s.redirect("/signin")):(i=User.update(e.body),s.json({status:!0,result:i}))},create:function(e,s){validate(User,{name:e.body.username},e,s)},createAdmin:function(e,s){User.createAdmin();s.json({})},delete:function(e,s){User.delete(e.body),s.json({status:!0,msg:"删除成功！"})}};