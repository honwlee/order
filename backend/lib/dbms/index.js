var _=require("lodash"),_db=require("underscore-db"),low=require("lowdb"),FileSync=require("lowdb/adapters/FileSync"),validateData=require("./validate"),mixins=require("./mixins");module.exports=function(e,a={}){a.master_file_name=a.master_file_name||"master.json";var r={},i={},n={};function t(e){var a=new FileSync(e),r=low(a);return validateData(r.getState()),r._.mixin(_db),r._.mixin(mixins),r.forEach(function(e,a){i[a]=r}).value(),r}var u=t(e+"/"+a.master_file_name).get("tables");function s(a){var n=i[a];if(!n){var s=u.find({name:a}).value();s&&((n=r[s.spaceFileName])||(n=r[s.spaceFileName]=t(e+"/"+s.spaceFileName)))}return n}return n.get=function(e){var a=s(e);return a&&a.get(e)},n.has=function(e){return!!i[e]},n.set=function(e,a){var r=s(e);return r&&r.set(e,a),this},n.push=function(e,a){return this.get(e).push(a).write()},n.create=function(e,a){var r=s(e);return r||(a.spaceFileName=a.spaceFileName||e+".json",u.insert({name:e,spaceFileName:a.spaceFileName}).value(),r=s(e)),r},n.drop=function(e){},n};