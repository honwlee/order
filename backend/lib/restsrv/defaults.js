"use strict";var fs=require("fs"),path=require("path"),express=require("express"),logger=require("morgan"),cors=require("cors"),compression=require("compression"),errorhandler=require("errorhandler"),objectAssign=require("object-assign");module.exports=function(e){var r=path.join(process.cwd(),"public"),s=path.join(__dirname,"public"),o=fs.existsSync(r)?r:s,n=[];return(e=objectAssign({logger:!0,static:o},e)).noGzip||n.push(compression()),e.logger&&n.push(logger("dev",{skip:function(e){return"test"===process.env.NODE_ENV||"/favicon.ico"===e.path}})),e.noCors||n.push(cors({origin:!0,credentials:!0})),"development"===process.env.NODE_ENV&&n.push(errorhandler()),n.push(express.static(e.static)),n.push(function(e,r,s){r.header("Cache-Control","no-cache"),r.header("Pragma","no-cache"),r.header("Expires","-1"),s()}),e.readOnly&&n.push(function(e,r,s){"GET"===e.method?s():r.sendStatus(403)}),n};